!function(){"use strict";const t=console,e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var s;!function(t){t.escape=function(t){let s=t;for(const[t,n]of Object.entries(e))s=s.replace(new RegExp(t,"g"),n);return s.replace(/\n/g,"<br>")},t.unescape=function(t){let s=t.replace(/<br>/g,"\n");for(const[t,n]of Object.entries(e))s=s.replace(new RegExp(n,"g"),t);return s},t.mod=function(t,e){return(t%e+e)%e},t.deepNoop=function(){const t=new Proxy(()=>{},{get:()=>t});return t},t.capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},t.delay=function(t){return new Promise((e,s)=>{setTimeout(()=>e(),t)})},t.randomItem=function(t){return t[Math.floor(Math.random()*t.length)]},t.randomInt=function(t,e){return e?t+Math.floor(Math.random()*(e-t)):Math.floor(Math.random()*t)},t.sum=function(t){return t.reduce((t,e)=>t+e,0)},t.prettyNumber=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},t.trimPrefix=function(t,e){return t.startsWith(e)?t.substr(e.length):t},t.trimSuffix=function(t,e){return t.endsWith(e)?t.substr(0,t.length-e.length):t},t.trimPrefixes=function t(e,s){for(const n of s)if(e.startsWith(n))return t(e.substr(n.length),s);return e},t.trimSuffixes=function t(e,s){for(const n of s)if(e.endsWith(n))return t(e.substr(0,e.length-n.length),s);return e}}(s||(s={}));const n=document.querySelector("svg.model-graph"),i=document.querySelector(".graph-container"),r=(document.querySelector(".downloads-number"),document.querySelector(".info-box")),o=.1,a=30,l=["January","February","March","April","May","June","July","August","September","October","November","December"];class c{constructor(...t){const e=t.reduce((t,e)=>[...t,...e]);this.largestNumber=Math.max(...e)}getLargestNumber(){return this.largestNumber}}class d{constructor(t,e=236){this.rawModelDownloads=[],this.rawDates=[],this.modelDownloaded=[],this.datesOfDownloads=[],t.forEach(t=>{this.rawModelDownloads.push(parseInt(t.doc_count)),this.rawDates.push(parseInt(t.key_as_string))}),this.gradientIdentifier=s.randomInt(1e4),this.primaryGraphColor=e,this.popOrShiftArrayLength()}popOrShiftArrayLength(){if(this.rawModelDownloads.length>a)this.modelDownloaded=this.rawModelDownloads.slice(-Math.abs(a)),this.datesOfDownloads=this.rawDates.slice(-Math.abs(a));else if(this.rawModelDownloads.length<a){let t=0===this.rawDates[0]?0:new Date(this.rawDates[0]);this.modelDownloaded=[...this.rawModelDownloads],this.datesOfDownloads=[...this.rawDates];for(let e=this.rawModelDownloads.length;e<a;e++){if(0===t)this.datesOfDownloads.unshift(0);else{const s=new Date(t);s.setDate(s.getDate()-e),this.datesOfDownloads.unshift(s.getTime())}this.modelDownloaded.unshift(0)}}else this.modelDownloaded=[...this.rawModelDownloads],this.datesOfDownloads=[...this.rawDates]}createPointsForGraph(t){this.xyPoints=this.modelDownloaded.map((e,s)=>[10*s,e/(t+10)*100]),this.svgPath()}line(t,e){const s=e[0]-t[0],n=e[1]-t[1];return{length:Math.sqrt(Math.pow(s,2)+Math.pow(n,2)),angle:Math.atan2(n,s)}}controlPoint(t,e,s,n=!1){const i=e||t,r=s||t,a=this.line(i,r),l=a.angle+(n?Math.PI:0),c=a.length*(0===i[1]?0:o);return[t[0]+Math.cos(l)*c,t[1]+Math.sin(l)*c]}bezier(t,e){const[s,n]=this.controlPoint(this.xyPoints[e-1],this.xyPoints[e-2],t),[i,r]=this.controlPoint(t,this.xyPoints[e-1],this.xyPoints[e+1],!0);return`C ${s},${n} ${i},${r} ${t[0]},${t[1]}`}svgPath(){const t=this.xyPoints.map((t,e)=>0===e?`${t[0]},${t[1]}`:`${this.bezier(t,e)}`).join("");return`\n\t\t\t\t<path d="M 0,-20 ${t} L 290,-20" \n\t\t\t\tfill="url(#fill-gradient${this.gradientIdentifier})"\n\t\t\t\tstroke="none" />\n\t\t\t\t<path d="M 0,-20 ${t}" \n\t\t\t\tfill="none"\n\t\t\t\tstroke="url(#line-gradient${this.gradientIdentifier})" />\n\t\t`}svgCircle(){const[t]=this.xyPoints.slice(-1),[e,s]=t;return`\n\t\t\t<circle cx="${e}" cy="${s-1.5}" \n\t\t\t\tr="3" fill="#ffffff" \n\t\t\t\tstroke="${this.getGraphColor().color1}" \n\t\t\t\tstroke-width="2" \n\t\t\t/>\n\t\t`}getGraphColor(){return{color1:`hsl(${this.primaryGraphColor}, 91%, 60%)`,color2:`hsl(${this.primaryGraphColor+10}, 98%, 60%)`}}svgGraphColor(){return`\n\t\t\t<defs>\n\t\t\t\t<linearGradient id="line-gradient${this.gradientIdentifier}" x1="0%" y1="0%" x2="100%" y2="0%">\n\t\t\t\t\t<stop offset="0%" style="stop-color: ${this.getGraphColor().color1}; stop-opacity: 1" />\n\t\t\t\t\t<stop offset="100%" style="stop-color: ${this.getGraphColor().color2}"; stop-opacity: 1 />\n\t\t\t\t</linearGradient>\n\t\t\t\t<linearGradient id="fill-gradient${this.gradientIdentifier}" x1="0%" y1="0%" x2="100%" y2="0%">\n\t\t\t\t\t<stop offset="0%" style="stop-color: ${this.getGraphColor().color1}; stop-opacity:0.5" />\n\t\t\t\t\t<stop offset="100%" style="stop-color: ${this.getGraphColor().color2}; stop-opacity:0" />\n\t\t\t\t</linearGradient>\n\t\t\t</defs>\n\t\t`}getDownloadsData(){return this.modelDownloaded}getDates(){return this.datesOfDownloads}getFormattedHtml(){return this.htmlOutput=`<g>${this.svgGraphColor()+this.svgPath()+this.svgCircle()}</g>`,this.htmlOutput}}const u=(t,e,o)=>{document.querySelectorAll("rect").forEach((n,a)=>{n.addEventListener("mouseover",function(n){const c=s.prettyNumber(t[a]),d=s.prettyNumber(e[a]),u=n.pageX-i.offsetLeft;r.innerHTML=`\n\t\t\t\t${((t,e)=>{const s=new Date(t[e]);return`\n\t<span class="date">\n\t\t&nbsp; ${`${l[s.getMonth()]} ${s.getDate()}`}\n\t</span>\n\t`})(o,a)}\n\t\t\t\t<br>\n\t\t\t\t<span class="model-key pytorch"></span> ${c}\n\t\t\t\t<br>\n\t\t\t\t<span class="model-key tf"></span> ${d}\n\t\t\t`,r.style.left=`${u<=200?u+50:u-180}px`})}),n.addEventListener("mouseenter",function(){r.style.display="block"}),n.addEventListener("mouseleave",function(){r.style.display="none"})},h=(t,e)=>{const s=[],n=[];t.map((t,i)=>{n.push(void 0===e[i]?{doc_count:0,key_as_string:0}:e[i]),e.map(e=>{e.key_as_string===t.key_as_string&&s.push(i)})});for(const[t,e]of Object.entries(s))[n[t],n[e]]=[n[e],n[t]];return n},p=()=>{const t=new Date;return t.setDate(t.getDate()-1),[{doc_count:0,key_as_string:t.getTime()}]},m=()=>{let t,e,{pytorch:s,tf:i}=getHistograms();0===s.length&&0===i.length&&(s=p(),i=p()),s.length>=i.length?(t=s,e=h(s,i)):(e=i,t=h(i,s));const r=new d(t),o=new d(e,282),l=r.getDates().length>=o.getDates().length?r.getDates():o.getDates(),m=new c(r.getDownloadsData(),o.getDownloadsData());r.createPointsForGraph(m.getLargestNumber()),o.createPointsForGraph(m.getLargestNumber()),n.innerHTML=o.getFormattedHtml()+r.getFormattedHtml()+(()=>{const t=[];for(let e=0;e<a;e++){const s=`\n\t\t\t<rect x="${10*e-5}" y="-10" \n\t\t\t\twidth="10" height="105" stroke-width="0" \n\t\t\t\tclass="graph-highlight" \n\t\t\t/>\n\t\t`,n=`\n\t\t\t<line x1="${10*e}" y1="-20" \n\t\t\t\tx2="${10*e}" y2="120" \n\t\t\t\tstroke-width="1" \n\t\t\t\tclass="single-line" \n\t\t\t/>\n\t\t`;t.push(s+n)}return`<g>${t.join("")}</g>`})(),u(r.getDownloadsData(),o.getDownloadsData(),l),((t,e)=>{t.reduce((t,e)=>t+e,0),e.reduce((t,e)=>t+e,0)})(r.getDownloadsData(),o.getDownloadsData())},f=t=>{const e=document.createElement("textarea");document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e)};class g{constructor(e){var s;this.className=e,this.div=document.querySelector(`div.modal.${e}`),this.doneBtn=this.div.querySelector(".js-close"),this.loader=this.div.querySelector(".js-loader"),null===(s=this.doneBtn)||void 0===s||s.addEventListener("click",t=>{t.preventDefault(),this.hide()}),this.div.addEventListener("click",e=>{e.target===this.div&&(t.debug("modal:background.click"),this.hide())}),window.location.hash.slice(1)===this.className&&this.div.classList.remove("hide")}async show(){window.history.replaceState(null,"",`#${this.className}`),await this.performBeforeShow(),this.div.classList.add("fadeout"),this.div.classList.remove("hide"),await s.delay(100),this.div.classList.remove("fadeout"),await this.performShow(),this.loader.classList.add("hide")}async hide(){window.history.replaceState(null,"","#"),this.div.classList.add("fadeout"),await s.delay(200),this.div.classList.add("hide"),this.div.classList.remove("fadeout"),await this.performHide()}}class v extends g{constructor(){super("list-files")}async performBeforeShow(){}async performShow(){}async performHide(){}}class y{constructor(t={}){this.opts=t,this.params={},this.div=document.querySelector("div.objects-search"),this.inputSearch=this.div.querySelector("input.search"),this.detailsFltr=this.div.querySelector("details.js-search_filter"),this.summaryTFltr=this.detailsFltr.querySelector("summary > span"),this.dropItemsFltr=[...this.detailsFltr.querySelectorAll(".dropdown-item")],this.detailsSort=this.div.querySelector("details.js-search_sort"),this.summaryTSort=this.detailsSort.querySelector("summary > span"),this.dropItemsSort=[...this.detailsSort.querySelectorAll(".dropdown-item")],this.inputSearch.addEventListener("input",t=>{this.inputSearch.value.length>0?this.params.search=this.inputSearch.value:delete this.params.search,this.update()}),this.dropItemsFltr[0].addEventListener("click",()=>{delete this.params.filter,this.update()});for(const t of this.dropItemsFltr.slice(1))t.addEventListener("click",()=>{t.classList.toggle("active");const e=this.dropItemsFltr.slice(1).filter(t=>t.classList.contains("active")).map(t=>t.id);e.length>0?this.params.filter=e:delete this.params.filter,this.update()});for(const t of this.dropItemsSort)t.addEventListener("click",()=>{this.params.sort=t.id,"default"===this.params.sort&&delete this.params.sort,this.detailsSort.removeAttribute("open"),this.update()})}launch(){var t;if(null===(t=this.opts.atLaunchParseUrl)||void 0===t||t){const t=new URL(window.location.href).searchParams;if([...t.keys()].length>0){const e=[...t.entries()].map(([t,e])=>{return[t,e.includes(",")?e.split(","):e]}),s=Object.fromEntries(e);"string"==typeof s.filter&&(s.filter=[s.filter]),s.search&&(this.inputSearch.value=s.search),this.params=s,this.update({urlUpdate:!1})}}}updateUI(){var t;if(this.params.filter&&0!==this.params.filter.length){this.dropItemsFltr[0].classList.remove("active");for(const t of this.dropItemsFltr.slice(1))this.params.filter.includes(t.id)?t.classList.add("active"):t.classList.remove("active");this.updateFilterSummaryText()}else{this.dropItemsFltr[0].classList.add("active");for(const t of this.dropItemsFltr.slice(1))t.classList.remove("active")}this.updateFilterSummaryText();for(const e of this.dropItemsSort)if(e.id===this.params.sort||void 0===this.params.sort&&"default"===e.id){e.classList.add("active");const s=null===(t=e.querySelector("span.name"))||void 0===t?void 0:t.textContent;this.summaryTSort.textContent=`Sort: ${s}`}else e.classList.remove("active")}updateFilterSummaryText(){if(this.params.filter){const t=this.params.filter.join(", ");t.length<=12?this.summaryTFltr.textContent=`Tags: ${t}`:this.summaryTFltr.textContent=`Tags: ${t.substr(0,12)}...`}else this.summaryTFltr.textContent="Tags: All"}update(e={}){var s,n,i,r;t.debug("[update]",this.params),null===(n=(s=this.opts).onUpdate)||void 0===n||n.call(s,this.params),this.updateUI();const o=this.objects.filter(t=>!this.params.search||t.id.toLowerCase().includes(this.params.search.toLowerCase())).filter(t=>!this.params.filter||this.params.filter.every(e=>{var s;return(null!==(s=t.tags)&&void 0!==s?s:[]).includes(e)})).sort(this.sorterLogic(this.params.sort));if(this.render(o),(null===(i=this.opts.updateUrl)||void 0===i||i)&&(null===(r=e.urlUpdate)||void 0===r||r)){const t={};for(const[e,s]of Object.entries(this.params))t[e]=null==s?void 0:s.toString();const e=new URLSearchParams(t).toString().replace(/%2C/g,","),s=e.length>0?`${window.location.pathname}?${e}`:window.location.pathname;window.history.replaceState(null,"",s)}}sorterLogic(t){return"alphabetical"===t?(t,e)=>t.id.localeCompare(e.id):"downloads"===t?(t,e)=>e.downloads-t.downloads:"modified"===t?(t,e)=>e.lastModified.getTime()-t.lastModified.getTime():"natural"===t?(t,e)=>t.ni-e.ni:()=>0}}class b extends y{constructor(t={}){super(t),this.opts=t,this.objects=window.getAllModels().map(t=>(t.lastModified=new Date(t.lastModified),t)),this.renderEl=document.querySelector("ul.models-list")}render(t){const e=t.map(t=>`\n\t\t\t<li>\n\t\t\t\t<a href="/${t.id}">\n\t\t\t\t\t<code>${t.id}</code>\n\t\t\t\t</a>\n\t\t\t\t${void 0!==t.cs?'<img class="icon-star" src="/front/assets/icon-star.svg" title="Has a model card">':""}\n\t\t\t\t<span class="tooltip">\n\t\t\t\t\t${void 0===t.downloads?"Unknown":s.prettyNumber(t.downloads)}\n\t\t\t\t\tdownloads last 30 days - Last updated on ${t.lastModified.toUTCString()}\n\t\t\t\t</span>\n\t\t\t</li>\n\t\t\t`).join("");this.renderEl.innerHTML=e}}class w extends y{constructor(t={}){super(t),this.opts=t,this.objects=window.getAllObjects().map(t=>(t.lastModified=new Date(t.lastModified),t)),this.renderEl=document.querySelector("div.objects-list")}render(t){const e=t.map(t=>{var e;let s;return 1===t.numModels?s="1 model":null!==(e=t.numModels)&&void 0!==e&&e&&(s=`${t.numModels} models`),`\n\t\t\t<div class="object">\n\t\t\t\t<div class="clearfix">\n\t\t\t\t\t<div class="id">\n\t\t\t\t\t\t<a href="/datasets/${t.id}">${t.id} <span class="emoji">ðŸ·</span></a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class="num-models ${(null==s?void 0:s.length)?"":"hide"}">\n\t\t\t\t\t\t<a href="/datasets/${t.id}#models">\n\t\t\t\t\t\t\t${s}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="description">\n\t\t\t\t\t${t.description}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`}).join("");this.renderEl.innerHTML=e}}class S{async uploadFile(t){const e=await fetch("/uploads",{method:"POST",headers:{"Content-Type":t.type},body:t});return await e.text()}}S.sharedInstance=new S;const E=()=>s.randomItem(["Big-triangle","Polygon","Rectangle","cross","line","Oval","Rectangle-rotate","Triangle","dot"]);class L{constructor(t){this.div=t}setup(){this.resize(),window.addEventListener("resize",()=>{this.resize()})}resize(){this.div.innerHTML="";const t=Math.ceil(this.div.clientWidth/220),e=Math.ceil(this.div.clientHeight/220);for(let n=0;n<t;n++)for(let t=0;t<e;t++){const e=220*t+20+s.randomInt(-50,80),i=220*n+20+s.randomInt(-50,80),r=document.createElement("img");r.src=`/front/assets/pattern/${E()}.svg`,r.style.top=`${e}px`,r.style.left=`${i}px`,this.div.appendChild(r)}}}class A{constructor(t,e={}){if(!(t instanceof Node))throw"Can't initialize VanillaTilt because "+t+" is not a Node.";this.width=null,this.height=null,this.left=null,this.top=null,this.transitionTimeout=null,this.updateCall=null,this.updateBind=this.update.bind(this),this.resetBind=this.reset.bind(this),this.element=t,this.settings=this.extendSettings(e),this.reverse=this.settings.reverse?-1:1,this.glare=this.isSettingTrue(this.settings.glare),this.glarePrerender=this.isSettingTrue(this.settings["glare-prerender"]),this.glare&&this.prepareGlare(),this.addEventListeners()}isSettingTrue(t){return""===t||!0===t||1===t}addEventListeners(){this.onMouseEnterBind=this.onMouseEnter.bind(this),this.onMouseMoveBind=this.onMouseMove.bind(this),this.onMouseLeaveBind=this.onMouseLeave.bind(this),this.onWindowResizeBind=this.onWindowResizeBind.bind(this),this.element.addEventListener("mouseenter",this.onMouseEnterBind),this.element.addEventListener("mousemove",this.onMouseMoveBind),this.element.addEventListener("mouseleave",this.onMouseLeaveBind),this.glare&&window.addEventListener("resize",this.onWindowResizeBind)}onMouseEnter(t){this.updateElementPosition(),this.element.style.willChange="transform",this.setTransition()}onMouseMove(t){null!==this.updateCall&&cancelAnimationFrame(this.updateCall),this.event=t,this.updateCall=requestAnimationFrame(this.updateBind)}onMouseLeave(t){this.setTransition(),this.settings.reset&&requestAnimationFrame(this.resetBind)}reset(){this.event={pageX:this.left+this.width/2,pageY:this.top+this.height/2},this.element.style.transform="perspective("+this.settings.perspective+"px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)",this.glare&&(this.glareElement.style.transform="rotate(180deg) translate(-50%, -50%)",this.glareElement.style.opacity="0")}getValues(){let t=(this.event.clientX-this.left)/this.width,e=(this.event.clientY-this.top)/this.height;return t=Math.min(Math.max(t,0),1),e=Math.min(Math.max(e,0),1),{tiltX:(this.reverse*(this.settings.max/2-t*this.settings.max)).toFixed(2),tiltY:(this.reverse*(e*this.settings.max-this.settings.max/2)).toFixed(2),percentageX:100*t,percentageY:100*e,angle:Math.atan2(this.event.clientX-(this.left+this.width/2),-(this.event.clientY-(this.top+this.height/2)))*(180/Math.PI)}}updateElementPosition(){let t=this.element.getBoundingClientRect();this.width=this.element.offsetWidth,this.height=this.element.offsetHeight,this.left=t.left,this.top=t.top}update(){const t=this.getValues();this.element.style.transform=["perspective("+this.settings.perspective+"px) ","rotateX("+("x"===this.settings.axis?0:t.tiltY)+"deg) ","rotateY("+("y"===this.settings.axis?0:t.tiltX)+"deg) ","scale3d("+this.settings.scale+", "+this.settings.scale+", "+this.settings.scale+")"].join(" "),this.glare&&(this.glareElement.style.transform=`rotate(${t.angle}deg) translate(-50%, -50%)`,this.glareElement.style.opacity=`${t.percentageY*this.settings["max-glare"]/100}`),this.element.dispatchEvent(new CustomEvent("tiltChange",{detail:t})),this.updateCall=null}prepareGlare(){if(!this.glarePrerender){const t=document.createElement("div");t.classList.add("js-tilt-glare");const e=document.createElement("div");e.classList.add("js-tilt-glare-inner"),t.appendChild(e),this.element.appendChild(t)}this.glareElementWrapper=this.element.querySelector(".js-tilt-glare"),this.glareElement=this.element.querySelector(".js-tilt-glare-inner"),this.glarePrerender||(Object.assign(this.glareElementWrapper.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden","pointer-events":"none"}),Object.assign(this.glareElement.style,{position:"absolute",top:"50%",left:"50%","pointer-events":"none","background-image":"linear-gradient(0deg, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%)",width:`${2*this.element.offsetWidth}px`,height:`${2*this.element.offsetWidth}px`,transform:"rotate(180deg) translate(-50%, -50%)","transform-origin":"0% 0%",opacity:"0"}))}updateGlareSize(){Object.assign(this.glareElement.style,{width:`${2*this.element.offsetWidth}`,height:`${2*this.element.offsetWidth}`})}onWindowResizeBind(){this.updateGlareSize()}setTransition(){this.transitionTimeout&&clearTimeout(this.transitionTimeout),this.element.style.transition="transform .4s cubic-bezier(0,0,.2,1)",this.glare&&(this.glareElement.style.transition=`opacity ${this.settings.speed}ms ${this.settings.easing}`),this.transitionTimeout=setTimeout(()=>{this.element.style.transition="",this.glare&&(this.glareElement.style.transition="")},this.settings.speed)}extendSettings(t){let e={reverse:!1,max:35,perspective:1e3,easing:"cubic-bezier(.03,.98,.52,.99)",scale:"1",speed:"300",transition:!0,axis:null,glare:!1,"max-glare":1,"glare-prerender":!1,reset:!0},s={};for(var n in e)if(n in t)s[n]=t[n];else if(this.element.hasAttribute("data-tilt-"+n)){let t=this.element.getAttribute("data-tilt-"+n);try{s[n]=JSON.parse(t)}catch(e){s[n]=t}}else s[n]=e[n];return s}static init(t,e={}){t instanceof Node&&(t=[t]),t instanceof NodeList&&(t=[].slice.call(t)),t instanceof Array&&t.forEach(t=>{"vanillaTilt"in t||(t.vanillaTilt=new A(t,e))})}}class x extends CustomEvent{constructor(t,e){super(t,e),this.relatedTarget=e.relatedTarget}}const T=new WeakMap;function M(t,e){const s=new XMLHttpRequest;return s.responseType="json",s.open("GET",e,!0),s.setRequestHeader("Accept","application/json"),function(t,e){const s=T.get(t);s&&s.abort();T.set(t,e);const n=()=>T.delete(t),i=function(t){return new Promise((e,s)=>{t.onload=function(){t.status>=200&&t.status<300?e(t.response):s(new Error(t.responseText))},t.onerror=s,t.send()})}(e);return i.then(n,n),i}(t,s)}const $=!!navigator.userAgent.match(/Macintosh/);class C{constructor(t,e){this.input=t,this.list=e,this.isComposing=!1,e.id||(e.id=`combobox-${Math.random().toString().slice(2,6)}`),this.keyboardEventHandler=t=>(function(t,e){if(t.shiftKey||t.metaKey||t.altKey)return;if(!$&&t.ctrlKey)return;if(e.isComposing)return;switch(t.key){case"Enter":case"Tab":(function(t,e){const s=e.querySelector('[aria-selected="true"]');return!(!s||"true"!==s.getAttribute("aria-disabled")&&(s.click(),0))})(e.input,e.list)&&t.preventDefault();break;case"Escape":e.clearSelection();break;case"ArrowDown":e.navigate(1),t.preventDefault();break;case"ArrowUp":e.navigate(-1),t.preventDefault();break;case"n":$&&t.ctrlKey&&(e.navigate(1),t.preventDefault());break;case"p":$&&t.ctrlKey&&(e.navigate(-1),t.preventDefault());break;default:if(t.ctrlKey)break;e.clearSelection()}})(t,this),this.compositionEventHandler=t=>(function(t,e){if(e.isComposing="compositionstart"===t.type,!document.getElementById(e.input.getAttribute("aria-controls")||""))return;e.clearSelection()})(t,this),this.inputHandler=this.clearSelection.bind(this),t.setAttribute("role","combobox"),t.setAttribute("aria-controls",e.id),t.setAttribute("aria-expanded","false"),t.setAttribute("aria-autocomplete","list"),t.setAttribute("aria-haspopup","listbox")}destroy(){this.clearSelection(),this.stop(),this.input.removeAttribute("role"),this.input.removeAttribute("aria-controls"),this.input.removeAttribute("aria-expanded"),this.input.removeAttribute("aria-autocomplete"),this.input.removeAttribute("aria-haspopup")}start(){this.input.setAttribute("aria-expanded","true"),this.input.addEventListener("compositionstart",this.compositionEventHandler),this.input.addEventListener("compositionend",this.compositionEventHandler),this.input.addEventListener("input",this.inputHandler),this.input.addEventListener("keydown",this.keyboardEventHandler),this.list.addEventListener("click",k)}stop(){this.clearSelection(),this.input.setAttribute("aria-expanded","false"),this.input.removeEventListener("compositionstart",this.compositionEventHandler),this.input.removeEventListener("compositionend",this.compositionEventHandler),this.input.removeEventListener("input",this.inputHandler),this.input.removeEventListener("keydown",this.keyboardEventHandler),this.list.removeEventListener("click",k)}navigate(t=1){const e=Array.from(this.list.querySelectorAll('[aria-selected="true"]')).filter(q)[0],s=Array.from(this.list.querySelectorAll('[role="option"]')).filter(q),n=s.indexOf(e);if(n===s.length-1&&1===t||0===n&&-1===t)return this.clearSelection(),void this.input.focus();let i=1===t?0:s.length-1;if(e&&n>=0){const e=n+t;e>=0&&e<s.length&&(i=e)}const r=s[i];if(r)for(const t of s)r===t?(this.input.setAttribute("aria-activedescendant",r.id),r.setAttribute("aria-selected","true"),_(this.list,r)):t.setAttribute("aria-selected","false")}clearSelection(){this.input.removeAttribute("aria-activedescendant");for(const t of this.list.querySelectorAll('[aria-selected="true"]'))t.setAttribute("aria-selected","false")}}function k(t){if(!(t.target instanceof Element))return;const e=t.target.closest('[role="option"]');e&&"true"!==e.getAttribute("aria-disabled")&&function(t){t.dispatchEvent(new CustomEvent("combobox-commit",{bubbles:!0}))}(e)}function q(t){return!t.hidden&&!(t instanceof HTMLInputElement&&"hidden"===t.type)&&(t.offsetWidth>0||t.offsetHeight>0)}function _(t,e){(function(t,e){const s=t.scrollTop,n=s+t.clientHeight,i=e.offsetTop,r=i+e.clientHeight;return i>=s&&r<=n})(t,e)||(t.scrollTop=e.offsetTop)}class D extends HTMLUListElement{connectedCallback(){const t=this.getAttribute("data-types");(null==t?void 0:t.length)&&(this.resultTypes=new Set(t.split(",")))}generateHtml(t){var e,s,n,i;let r="";return(null===(e=t.models)||void 0===e?void 0:e.length)&&this.isDisplayed("model")&&(r+=t.models.map(t=>`\n\t\t\t\t<li role="option" class="autocomplete-item" data-autocomplete-value="${t}">\n\t\t\t\t\t<code>${t}</code>\n\t\t\t\t</li>\n\t\t\t`).join("")),(null===(s=t.datasets)||void 0===s?void 0:s.length)&&this.isDisplayed("dataset")&&(r+=t.datasets.map(t=>`\n\t\t\t\t<li role="option" class="autocomplete-item" data-autocomplete-value="${t}">\n\t\t\t\t\t${t}\n\t\t\t\t</li>\n\t\t\t`).join("")),(null===(n=t.orgs)||void 0===n?void 0:n.length)&&this.isDisplayed("org")&&(r+=t.orgs.map(t=>`\n\t\t\t\t<li role="option" class="autocomplete-item" data-autocomplete-value="${t.name}">\n\t\t\t\t\t<img class="avatar-organization" src="${t.avatarUrl}">\n\t\t\t\t\t${t.name}\n\t\t\t\t</li>\n\t\t\t`).join("")),(null===(i=t.users)||void 0===i?void 0:i.length)&&this.isDisplayed("user")&&(r+=t.users.map(t=>`\n\t\t\t\t<li role="option" class="autocomplete-item" data-autocomplete-value="${t.name}">\n\t\t\t\t\t<img class="avatar-user" src="${t.avatarUrl}">\n\t\t\t\t\t${t.name}\n\t\t\t\t</li>\n\t\t\t`).join("")),r}isDisplayed(t){return!this.resultTypes||this.resultTypes.has(t)}}class j{constructor(t,e,s){this.container=t,this.input=e,this.results=s,this.combobox=new C(e,s),this.results.hidden=!0,this.input.setAttribute("autocomplete","off"),this.input.setAttribute("spellcheck","false"),this.interactingWithList=!1,this.onInputChange=function(t,e=0){let s;return function(...n){clearTimeout(s),s=window.setTimeout(()=>{clearTimeout(s),t(...n)},e)}}(this.onInputChange.bind(this),300),this.onResultsMouseDown=this.onResultsMouseDown.bind(this),this.onInputBlur=this.onInputBlur.bind(this),this.onInputFocus=this.onInputFocus.bind(this),this.onKeydown=this.onKeydown.bind(this),this.onCommit=this.onCommit.bind(this),this.input.addEventListener("keydown",this.onKeydown),this.input.addEventListener("focus",this.onInputFocus),this.input.addEventListener("blur",this.onInputBlur),this.input.addEventListener("input",this.onInputChange),this.results.addEventListener("mousedown",this.onResultsMouseDown),this.results.addEventListener("combobox-commit",this.onCommit)}destroy(){this.input.removeEventListener("keydown",this.onKeydown),this.input.removeEventListener("focus",this.onInputFocus),this.input.removeEventListener("blur",this.onInputBlur),this.input.removeEventListener("input",this.onInputChange),this.results.removeEventListener("mousedown",this.onResultsMouseDown),this.results.removeEventListener("combobox-commit",this.onCommit)}onKeydown(t){if("Escape"===t.key&&this.container.open)this.container.open=!1,t.stopPropagation(),t.preventDefault();else if(t.altKey&&"ArrowUp"===t.key&&this.container.open)this.container.open=!1,t.stopPropagation(),t.preventDefault();else if(t.altKey&&"ArrowDown"===t.key&&!this.container.open){if(!this.input.value.trim())return;this.container.open=!0,t.stopPropagation(),t.preventDefault()}}onInputFocus(){this.fetchResults()}onInputBlur(){this.interactingWithList?this.interactingWithList=!1:this.container.open=!1}onCommit({target:t}){const e=t;if(!(e instanceof HTMLElement))return;if(this.container.open=!1,e instanceof HTMLAnchorElement)return;const s=e.getAttribute("data-autocomplete-value")||e.textContent;this.container.value=s}onResultsMouseDown(){this.interactingWithList=!0}onInputChange(){this.container.removeAttribute("value"),this.fetchResults()}identifyOptions(){let t=0;for(const e of this.results.querySelectorAll('[role="option"]:not([id])'))e.id=`${this.results.id}-option-${t++}`}fetchResults(){const t=this.input.value.trim(),e=this.container.src;if(!e)return;const s=new URL(e,window.location.href),n=new URLSearchParams;n.append("q",t),s.search=n.toString(),this.container.dispatchEvent(new CustomEvent("loadstart")),M(this.input,s.toString()).then(t=>{const e=this.results instanceof D?this.results.generateHtml(t):function(t){var e,s,n,i;let r="";(null===(e=t.models)||void 0===e?void 0:e.length)&&(r+='<li class="header">Models</li>',r+=t.models.map(t=>`\n\t\t\t<li role="option" class="autocomplete-item" data-autocomplete-value="/${t}">\n\t\t\t\t<code>${t}</code>\n\t\t\t</li>\n\t\t`).join(""));(null===(s=t.datasets)||void 0===s?void 0:s.length)&&(r+='<li class="header">Datasets</li>',r+=t.datasets.map(t=>`\n\t\t\t<li role="option" class="autocomplete-item" data-autocomplete-value="/datasets/${t}">\n\t\t\t\t${t}\n\t\t\t</li>\n\t\t`).join(""));(null===(n=t.orgs)||void 0===n?void 0:n.length)&&(r+='<li class="header">Organizations</li>',r+=t.orgs.map(t=>`\n\t\t\t<li role="option" class="autocomplete-item" data-autocomplete-value="/${t.name}">\n\t\t\t\t<img class="avatar-organization" src="${t.avatarUrl}">\n\t\t\t\t${t.name}\n\t\t\t</li>\n\t\t`).join(""));(null===(i=t.users)||void 0===i?void 0:i.length)&&(r+='<li class="header">Users</li>',r+=t.users.map(t=>`\n\t\t\t<li role="option" class="autocomplete-item" data-autocomplete-value="/${t.name}">\n\t\t\t\t<img class="avatar-user" src="${t.avatarUrl}">\n\t\t\t\t${t.name}\n\t\t\t</li>\n\t\t`).join(""));return r}(t);this.results.innerHTML=e,this.identifyOptions();const s=!!this.results.querySelector('[role="option"]');this.container.open=s,this.container.dispatchEvent(new CustomEvent("load")),this.container.dispatchEvent(new CustomEvent("loadend"))}).catch(()=>{this.container.dispatchEvent(new CustomEvent("error")),this.container.dispatchEvent(new CustomEvent("loadend"))})}open(){this.results.hidden&&(this.combobox.start(),this.results.hidden=!1)}close(){this.results.hidden||(this.combobox.stop(),this.results.hidden=!0)}}const I=new WeakMap;class P extends HTMLElement{constructor(){super()}connectedCallback(){const t=this.getAttribute("for");if(!t)return;const e=this.querySelector("input"),s=this.querySelector(`[name=${t}]`);e instanceof HTMLInputElement&&s&&(I.set(this,new j(this,e,s)),s.setAttribute("role","listbox"))}disconnectedCallback(){const t=I.get(this);t&&(t.destroy(),I.delete(this))}get src(){return this.getAttribute("src")||""}set src(t){this.setAttribute("src",t)}get value(){return this.getAttribute("value")||""}set value(t){this.setAttribute("value",t)}get open(){return this.hasAttribute("open")}set open(t){t?this.setAttribute("open",""):this.removeAttribute("open")}static get observedAttributes(){return["open","value"]}attributeChangedCallback(t,e,s){if(e===s)return;const n=I.get(this);if(n)switch(t){case"open":null===s?n.close():n.open();break;case"value":null!==s&&(n.input.value=s),this.dispatchEvent(new x("auto-complete-change",{bubbles:!0,relatedTarget:n.input}))}}}const H=(t,e)=>t.type===e.type&&t.start===e.start&&t.end===e.end;class O{constructor(t){this.text=t,this.spans=[]}static isValidOutput(t){return Array.isArray(t)&&t.every(t=>"string"==typeof t.word&&"string"==typeof t.entity_group)}render(t){if(!O.isValidOutput(t))throw new Error("Invalid output");const e=[];for(const s of t){e.some(t=>Object.keys(s).every(e=>s[e]===t[e]))||e.push(s)}for(const t of e){const e=this.findOneSpan(t);e&&this.spans.push(e)}return'<div class="medium">'+F.render(this.text,this.spans)+"</div>"}findOneSpan(t){const e=this.text.toLowerCase();let s=t.word.toLowerCase(),n=0;for(;-1!==n&&-1!==(n=e.indexOf(s,n));){const e={type:t.entity_group,start:n,end:n+s.length};if(!this.spans.some(t=>H(t,e)))return e;n++}for(s=t.word.toLowerCase().replace(/ /g,""),n=0;-1!==n&&-1!==(n=e.indexOf(s,n));){const e={type:t.entity_group,start:n,end:n+s.length};if(!this.spans.some(t=>H(t,e)))return e}}}class F{static sortSpans(t){t.sort((t,e)=>t.start===e.start?e.end-t.end:t.start-e.start),t.forEach((e,s)=>{if(s<t.length-1){const n=t[s+1];e.start<n.start&&e.end>n.start&&console.log("ERROR","Spans: strict overlapping")}})}static render(t,e,n){var i,r;this.sortSpans(e);const o={},a=(t,e,s)=>{Array.isArray(o[t])?o[t].push({span:e,tag:s}):o[t]=[{span:e,tag:s}]};for(const t of e)a(t.start,t,"start"),a(t.end,t,"end");let l={__content:"",append(t){this.__content+=t}},c=0;const d=Object.keys(o).map(t=>parseInt(t,10)).sort((t,e)=>t-e);for(const e of d){const a=o[e];e>c&&l.append(s.escape(t.slice(c,e))),c=e;for(const t of a)if("start"===t.tag){const e=s.mod(s.sum(Array.from(t.span.type).map(t=>t.charCodeAt(0))),8);l.append(n?`<mark data-entity="${t.span.type}" data-hash="${e}" data-index="${null!==(i=t.span.index)&&void 0!==i?i:""}" class="${n.join(" ")}">`:`<mark data-entity="${t.span.type}" data-hash="${e}" data-index="${null!==(r=t.span.index)&&void 0!==r?r:""}">`);const o=t.span.singleScore;o&&l.append(`<span class="single-score">${o.toFixed(3)}</span>`)}else l.append("</mark>")}return l.append(s.escape(t.slice(c,t.length))),l.__content}}class N{static render(t){if("string"!=typeof t.answer||"number"!=typeof t.score)throw new Error("Invalid output");return`\n\t\t\t<span class="answer large">${s.escape(t.answer)}</span>\n\t\t\t<span class="score">${t.score.toFixed(3)}</span>\n\t\t`}}class B{static render(t){try{const e=t[0].translation_text;return`\n\t\t\t\t<span class="answer large">${s.escape(e)}</span>\n\t\t\t`}catch(t){throw new Error("Invalid output")}}}class R{static render(t){try{const e=t[0].summary_text;return`\n\t\t\t\t<span class="answer large">${s.escape(e)}</span>\n\t\t\t`}catch(t){throw new Error("Invalid output")}}}class U{static render(t){try{const e=t[0].generated_text;return`\n\t\t\t\t<span class="answer large">${s.escape(e)}</span>\n\t\t\t`}catch(t){throw new Error("Invalid output")}}}class z{static render(t){try{return t[0].map(t=>`\n\t\t\t\t\t<div class="bar" style="width: ${100*t.score}%"></div>\n\t\t\t\t\t<div class="clearfix">\n\t\t\t\t\t\t<span class="label">${s.escape(t.label)}</span>\n\t\t\t\t\t\t<span class="score">${t.score.toFixed(3)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t`).join("")}catch(t){throw new Error("Invalid output")}}}class W{static render(t){try{const e=t[0].score;return t.map(t=>{const n=t.token_str,i=n.length>=2&&t.sequence.includes(n.slice(1))?n:s.trimSuffix(s.trimPrefix(t.sequence,"<s>"),"</s>");return`\n\t\t\t\t\t<div class="bar" style="width: ${t.score/e*100*.8}%"></div>\n\t\t\t\t\t<div class="clearfix">\n\t\t\t\t\t\t<span class="medium">${s.escape(i)}</span>\n\t\t\t\t\t\t<span class="score">${t.score.toFixed(3)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t`}).join("")}catch(t){throw new Error("Invalid output")}}}const G=t=>"object"==typeof t&&!!t.code&&!!t.error,J=t=>{const e=new URL(window.location.href).searchParams;for(const[s,n]of Object.entries(t))void 0===n?e.delete(s):e.set(s,n);const s=`${window.location.pathname}?${e.toString()}`;window.history.replaceState(null,"",s)};class K extends HTMLElement{constructor(){super(...arguments),this.inputText=this.querySelector("[name=text]"),this.inputContext=this.querySelector("textarea[name=context]"),this.btn=this.querySelector(".btn-widget"),this.computeZone=this.querySelector(".compute-zone"),this.outputPanel=this.querySelector(".output-panel"),this.outputZone=this.querySelector(".output-zone")}static install(){window.customElements.define("inference-widget",K)}connectedCallback(){window.widget=this,this.endpoint=this.getAttribute("endpoint"),this.model=this.dataset.model,this.mask_token=this.dataset.maskToken,this.pipeline_tag=this.dataset.pipelineTag,this.registerHandlers(),this.loadStatus();const t=new URL(window.location.href).searchParams;if(t.has("fullscreen")&&this.classList.add("fullscreen"),[...t.keys()].length>0){const e=t.get("text"),s=t.get("context");e&&(this.inputText.value=e),s&&this.inputContext&&(this.inputContext.value=s),this.btn.click()}else{const t=window.getWidgetData();if(Array.isArray(t)&&t.length>0){const e=s.randomItem(t);for(const[t,s]of Object.entries(e)){const e=this.querySelector(`[name="${t}"]`);(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&(e.value=s)}}}}registerHandlers(){var t,e;this.btn.addEventListener("click",()=>{this.handleClick()}),null===(t=this.querySelector("form"))||void 0===t||t.addEventListener("submit",t=>{t.preventDefault(),this.handleClick()}),null===(e=this.querySelector(".mask_token code"))||void 0===e||e.addEventListener("click",t=>{this.inputText.value+=this.mask_token});const s=this.querySelector("details.js-share");s&&s.addEventListener("toggle",()=>{s.open&&(f(window.location.href),setTimeout(()=>s.open=!1,1200))});const n=this.querySelector(".js-fullscreen");n&&n.addEventListener("click",()=>{this.classList.toggle("fullscreen");const t=this.classList.contains("fullscreen");J({fullscreen:!!t||void 0})})}async loadStatus(){const e=await fetch(`${this.endpoint}/status`),s=await e.json(),n=Object.values(s),i=Object.assign({},...n)[this.model];if(t.debug("load:status",i),i&&"object"==typeof i)if(G(i)){const t=this.querySelector(".blankslate .error");t&&(t.classList.remove("hide"),t.innerHTML+="<br>"+i.error)}else{const t=this.querySelector(".blankslate .loaded");null==t||t.classList.remove("hide")}else{const t=this.querySelector(".blankslate .unknown");null==t||t.classList.remove("hide")}}async handleClick(){var e,s,n;this.computeZone.innerHTML="",this.outputPanel.innerHTML="",this.outputZone.innerHTML="",null===(e=this.querySelector(".blankslate"))||void 0===e||e.classList.add("hide"),null===(s=this.querySelector(".not-blankslate"))||void 0===s||s.classList.remove("hide");const i=this.inputText.value;if(0===i.length)return void(this.outputPanel.innerHTML="You need to input some text");const r=null===(n=this.inputContext)||void 0===n?void 0:n.value,o="question-answering"===this.pipeline_tag?JSON.stringify({question:i,context:r}):JSON.stringify(i);if("question-answering"!==this.pipeline_tag){const t=this.querySelector(".js-api-input");t&&(t.innerText=JSON.stringify(i).replace(/'/g,""))}const a={text:i};(null==r?void 0:r.length)&&Object.assign(a,{context:r}),J(a),this.btn.disabled=!0;const l=await fetch(`${this.endpoint}/models/${this.model}`,{method:"POST",body:o}),c=await l.text(),d=JSON.parse(c);if(t.log("ðŸ”¥",c,d),this.btn.disabled=!1,l.headers.has("x-compute-time")){const t=l.headers.get("x-compute-time");this.computeZone.innerHTML=`Computation time on cpu: ${t} s`}const u=document.createElement("pre");if(u.innerText=JSON.stringify(d,null,2),this.outputZone.innerHTML="",this.outputZone.appendChild(u),l.ok)try{"text-classification"===this.pipeline_tag?this.outputPanel.innerHTML=z.render(d):"token-classification"===this.pipeline_tag?this.outputPanel.innerHTML=new O(i).render(d):"question-answering"===this.pipeline_tag?this.outputPanel.innerHTML=N.render(d):"translation"===this.pipeline_tag?this.outputPanel.innerHTML=B.render(d):"summarization"===this.pipeline_tag?this.outputPanel.innerHTML=R.render(d):"text-generation"===this.pipeline_tag?this.outputPanel.innerHTML=U.render(d):"fill-mask"===this.pipeline_tag&&(this.outputPanel.innerHTML=W.render(d))}catch(t){this.outputPanel.innerHTML=`<div class="red">âš ï¸ ${t.message}</div>`}else d.error?this.outputPanel.innerHTML=`<div class="red">âš ï¸ ${d.error}</div>`:d.traceback?this.outputPanel.innerHTML=`<div class="red">âš ï¸ ${d.traceback}</div>`:this.outputPanel.innerHTML=`<div class="red">${c}</div>`}}const X=[{name:"number",sort:(t,e)=>{let s=parseFloat(t),n=parseFloat(e);return(s=isNaN(s)?0:s)-(n=isNaN(n)?0:n)}}],Y=t=>{if(window.CustomEvent&&"function"==typeof window.CustomEvent)return new CustomEvent(t);{const e=document.createEvent("CustomEvent");return e.initCustomEvent(t,!1,!1,void 0),e}},V=t=>t.getAttribute("data-sort")||t.textContent||t.innerText||"",Z=(t,e)=>(t=t.trim().toLowerCase())===(e=e.trim().toLowerCase())?0:t<e?1:-1,Q=(t,e)=>[...t].find(t=>t.getAttribute("data-sort-column-key")===e),tt=(t,e)=>(function(s,n){const i=t(s.td,n.td);return 0===i?e?n.index-s.index:s.index-n.index:i});class et{constructor(t,e={}){var s;let n;if(this.el=t,this.options=e,t.rows&&t.rows.length>0&&(n=t.tHead&&t.tHead.rows.length>0?null!==(s=[...t.tHead.rows].find(t=>"thead"===t.getAttribute("data-sort-method")))&&void 0!==s?s:t.tHead.rows[t.tHead.rows.length-1]:t.rows[0]),n){for(const t of n.cells)t.setAttribute("role","columnheader"),"none"!==t.getAttribute("data-sort-method")&&(t.tabIndex=0,t.addEventListener("click",()=>{this.current&&this.current!==t&&this.current.removeAttribute("aria-sort"),this.current=t,this.sortTable(t)},!1),null!==t.getAttribute("data-sort-default")&&(this.defaultSort=t));this.defaultSort&&(this.current=this.defaultSort,this.sortTable(this.defaultSort))}}hasThead(){var t,e;return(null!==(e=null===(t=this.el.tHead)||void 0===t?void 0:t.rows.length)&&void 0!==e?e:0)>0}sortTable(t,e=!1){const s=t.getAttribute("data-sort-column-key"),n=t.cellIndex;let i=Z;const r=[],o=t.getAttribute("data-sort-method");let a=t.getAttribute("aria-sort");if(this.el.dispatchEvent(Y("beforeSort")),!1===e&&(a="ascending"===a?"descending":"descending"===a?"ascending":this.options.descending?"descending":"ascending",t.setAttribute("aria-sort",a)),!(this.el.rows.length<2)){if(!o){let t=this.hasThead()?0:1;for(;r.length<3&&t<this.el.tBodies[0].rows.length;){const e=s?Q(this.el.tBodies[0].rows[t].cells,s):this.el.tBodies[0].rows[t].cells[n];let i=e?V(e):"";(i=i.trim()).length>0&&r.push(i),t++}if(!r)return}for(const t of X)if(o){if(t.name===o){i=t.sort;break}}else if(t.pattern&&r.every(t.pattern)){i=t.sort;break}for(const t of this.el.tBodies){const e=[],r=[];let o=0,l=0;if(!(t.rows.length<2)){for(const i of t.rows){if("none"===i.getAttribute("data-sort-method"))r[o]=i;else{const t=s?Q(i.cells,s):i.cells[n];e.push({tr:i,td:t?V(t):"",index:o})}o++}"descending"===a?e.sort(tt(i,!0)):(e.sort(tt(i,!1)),e.reverse());for(let s=0;s<o;s++){let n;r[s]?(n=r[s],l++):n=e[s-l].tr,t.appendChild(n)}}}this.el.dispatchEvent(Y("afterSort"))}}refresh(){void 0!==this.current&&this.sortTable(this.current,!0)}}const st="data-close-dialog",nt=`[${st}]`;function it(t){let e=Array.from(t.querySelectorAll("[autofocus]")).filter(ot)[0];e||(e=t,t.setAttribute("tabindex","-1")),e.focus()}function rt(t){const e=t.currentTarget;e instanceof Element&&("Escape"===t.key||"Esc"===t.key?(dt(e,!1),t.stopPropagation()):"Tab"===t.key&&function(t){if(!(t.currentTarget instanceof Element))return;const e=t.currentTarget.querySelector("details-dialog");if(!e)return;t.preventDefault();const s=Array.from(e.querySelectorAll("*")).filter(ot);if(0===s.length)return;const n=t.shiftKey?-1:1,i=e.getRootNode(),r=e.contains(i.activeElement)?i.activeElement:null;let o=-1===n?-1:0;if(r instanceof HTMLElement){const t=s.indexOf(r);-1!==t&&(o=t+n)}o<0?o=s.length-1:o%=s.length;s[o].focus()}(t))}function ot(t){return t.tabIndex>=0&&!t.disabled&&function(t){return!t.hidden&&(!t.type||"hidden"!==t.type)&&(t.offsetWidth>0||t.offsetHeight>0)}(t)}function at(t){const e=t.querySelector("details-dialog");return!(e instanceof ft)||e.dispatchEvent(new CustomEvent("details-dialog-close",{bubbles:!0,cancelable:!0}))}function lt(t){if(!(t.currentTarget instanceof Element))return;const e=t.currentTarget.closest("details");e&&e.hasAttribute("open")&&(at(e)||(t.preventDefault(),t.stopPropagation()))}function ct(t){const e=t.currentTarget;if(!(e instanceof Element))return;const s=e.querySelector("details-dialog");if(s instanceof ft)if(e.hasAttribute("open")){const t="getRootNode"in s?s.getRootNode():document;t.activeElement instanceof HTMLElement&&mt.set(s,{details:e,activeElement:t.activeElement}),it(s),e.addEventListener("keydown",rt)}else{for(const t of s.querySelectorAll("form"))t.reset();const t=function(t,e){const s=mt.get(e);return s&&s.activeElement instanceof HTMLElement?s.activeElement:t.querySelector("summary")}(e,s);t&&t.focus(),e.removeEventListener("keydown",rt)}}function dt(t,e){e!==t.hasAttribute("open")&&(e?t.setAttribute("open",""):at(t)&&t.removeAttribute("open"))}function ut(t){const e=t.currentTarget;if(!(e instanceof Element))return;const s=e.querySelector("details-dialog");if(!(s instanceof ft))return;const n=s.querySelector("include-fragment:not([src])");if(!n)return;const i=s.src;null!==i&&(n.addEventListener("loadend",()=>{e.hasAttribute("open")&&it(s)}),n.setAttribute("src",i),pt(e))}function ht(t,e,s){pt(t),e&&t.addEventListener("toggle",ut,{once:!0}),e&&s&&t.addEventListener("mouseover",ut,{once:!0})}function pt(t){t.removeEventListener("toggle",ut),t.removeEventListener("mouseover",ut)}const mt=new WeakMap;class ft extends HTMLElement{static get CLOSE_ATTR(){return st}static get CLOSE_SELECTOR(){return nt}constructor(){super(),mt.set(this,{details:null,activeElement:null}),this.addEventListener("click",function({target:t}){if(!(t instanceof Element))return;const e=t.closest("details");e&&t.closest(nt)&&dt(e,!1)})}get src(){return this.getAttribute("src")}set src(t){this.setAttribute("src",t||"")}get preload(){return this.hasAttribute("preload")}set preload(t){t?this.setAttribute("preload",""):this.removeAttribute("preload")}connectedCallback(){this.setAttribute("role","dialog"),this.setAttribute("aria-modal","true");const t=mt.get(this);if(!t)return;const e=this.parentElement;if(!e)return;const s=e.querySelector("summary");s&&(s.hasAttribute("role")||s.setAttribute("role","button"),s.addEventListener("click",lt,{capture:!0})),e.addEventListener("toggle",ct),t.details=e,ht(e,this.src,this.preload)}disconnectedCallback(){const t=mt.get(this);if(!t)return;const{details:e}=t;if(!e)return;e.removeEventListener("toggle",ct),pt(e);const s=e.querySelector("summary");s&&s.removeEventListener("click",lt,{capture:!0}),t.details=null}toggle(t){const e=mt.get(this);if(!e)return;const{details:s}=e;s&&dt(s,t)}static get observedAttributes(){return["src","preload"]}attributeChangedCallback(){const t=mt.get(this);if(!t)return;const{details:e}=t;e&&ht(e,this.src,this.preload)}}var gt;!function(t){t.Approve="approve",t.Reject="reject"}(gt||(gt={}));class vt{constructor(){this.actionButtons=document.querySelectorAll(".member-action button"),this.init()}init(){for(const t of this.actionButtons){const e=t.getAttribute("data-action"),s=t.getAttribute("data-org"),n=t.getAttribute("data-user");t.addEventListener("click",async t=>{t.preventDefault(),await this.updateRequestStatus(e,s,n),window.location.reload()})}document.querySelector("details.details-add-user")&&this.initInviteForm()}initInviteForm(){window.customElements.get("details-dialog")||window.customElements.define("details-dialog",ft),window.customElements.get("autocomplete-simple-results")||window.customElements.define("autocomplete-simple-results",D,{extends:"ul"});const t=document.querySelector("details-dialog form"),e=document.querySelector("details-dialog .error"),s=document.querySelector('details-dialog [type="submit"]'),n=document.querySelector("details-dialog auto-complete");n.addEventListener("auto-complete-change",()=>{s.disabled=!n.value.length,e.hidden=!0}),t.addEventListener("reset",()=>{s.disabled=!0,e.hidden=!0}),t.addEventListener("submit",async s=>{s.preventDefault();const i=await fetch(t.action,{method:t.method,headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n.value})});if(i.ok)location.reload();else{const t=await i.text();e.innerHTML=t.length?t:`Unexpected error (code ${i.status})`,e.hidden=!1}})}async updateRequestStatus(t,e,s){switch(t){case gt.Approve:await fetch(`/organizations/${e}/settings/invite`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s})});break;case gt.Reject:await fetch(`/organizations/${e}/settings/request`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s})})}}}function yt(t){return function(t){if(Array.isArray(t)){for(var e=0,s=new Array(t.length);e<t.length;e++)s[e]=t[e];return s}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var bt="https://js.stripe.com/v3",wt=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,St="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",Et=null,Lt=function(t){return null!==Et?Et:Et=new Promise(function(e,s){if("undefined"!=typeof window)if(window.Stripe&&t&&console.warn(St),window.Stripe)e(window.Stripe);else try{var n=function(){for(var t=document.querySelectorAll('script[src^="'.concat(bt,'"]')),e=0;e<t.length;e++){var s=t[e];if(wt.test(s.src))return s}return null}();n&&t?console.warn(St):n||(n=function(t){var e=t&&!t.advancedFraudSignals?"?advancedFraudSignals=false":"",s=document.createElement("script");s.src="".concat(bt).concat(e);var n=document.head||document.body;if(!n)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(s),s}(t)),n.addEventListener("load",function(){window.Stripe?e(window.Stripe):s(new Error("Stripe.js not available"))}),n.addEventListener("error",function(){s(new Error("Failed to load Stripe.js"))})}catch(t){return void s(t)}else e(null)})},At=Promise.resolve().then(function(){return Lt(null)}),xt=!1;At.catch(function(t){xt||console.warn(t)});var Tt=function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return xt=!0,At.then(function(t){return function(t,e){if(null===t)return null;var s=t.apply(void 0,yt(e));return function(t){t&&t._registerWrapper&&t._registerWrapper({name:"stripe-js",version:"1.8.0"})}(s),s}(t,e)})};const Mt=window.location.hostname.includes("huggingface.co")?"pk_live_x2tdjFXBCvXo2FFmMybezpeM00J6gPCAAc":"pk_test_7y1Olrx3i4cvYcsUZfnVbcQ800bH8yP71r";class $t{constructor(t){this.baseApiUrl=t,this.orgs=document.querySelectorAll(".org-item"),this.products=document.querySelectorAll(".product-infos"),this.overlay=document.querySelector(".overlay"),this.form=document.querySelector("#subscription-form"),this.formErrors=this.form.querySelector(".form-errors"),this.submitBtn=this.form.querySelector('button[type="submit"]'),this.fullnameInput=this.form.querySelector("#name"),this.emailInput=this.form.querySelector("#email"),this.priceId=null,this.init()}async init(){this.stripe=await Tt(Mt),this.initOrgs(),this.initProducts();const t=this.stripe.elements();this.cardElement=t.create("card",{style:kt()}),this.cardElement.mount("#card-element"),this.cardElement.on("change",t=>this.onCardChange(t)),this.form.addEventListener("submit",async t=>{t.preventDefault(),this.overlay.hidden=!1,this.formErrors.hidden=!0;try{await this.onSubscriptionSubmit()}catch(t){this.displayError(t)}this.overlay.hidden=!0})}initProducts(){if(this.products.length>1)for(const t of this.products)t.addEventListener("click",e=>{e.stopPropagation(),this.onProductSelect(t)});else 1===this.products.length&&(this.products[0].classList.add("single"),this.priceId=this.products[0].getAttribute("data-price"),this.submitBtn.removeAttribute("disabled"))}initOrgs(){if(this.orgs.length)for(const t of this.orgs)"true"!==t.getAttribute("data-active-sub")&&t.addEventListener("click",e=>{e.stopPropagation(),this.onOrgSelect(t)})}async onSubscriptionSubmit(){var t;if(!this.isCardValid||!this.priceId)return;for(const t of[...this.products,...this.orgs])t.classList.add("disabled");const e=await this.stripe.createPaymentMethod({card:this.cardElement,type:"card",billing_details:{name:this.fullnameInput.value}});if(e.error)throw null!==(t=e.error.message)&&void 0!==t?t:JSON.stringify(e.error);let s,n=!1;if(this.subscriptionId?(s=await this.updatePaymentMethod(e.paymentMethod),n=!0):(s=await this.createSubscription(e.paymentMethod),this.subscriptionId=s.id),"requires_action"===s.paymentStatus||!0===n&&"requires_payment_method"===s.paymentStatus){const t=await this.stripe.confirmCardPayment(s.paymentSecret,{payment_method:e.paymentMethod.id});if(t.error)throw t.error.message;if("active"!==await this.getSubscriptionStatus())throw"The subscription was not activated, try refreshing the page and contact us at api-enterprise@huggingface.co if the status doesn't change."}else if("requires_payment_method"===s.paymentStatus)throw"Your credit card was declined, try again or use another one";this.overlay.hidden=!0,this.org?window.location.href=`/organizations/${this.org}/subscription`:window.location.reload()}async createSubscription(t){var e;return Ct(await fetch(`${this.baseApiUrl}/subscription`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethodId:t.id,paymentLast4:t.card.last4,priceId:this.priceId,email:null===(e=this.emailInput)||void 0===e?void 0:e.value})}))}async updatePaymentMethod(t){return Ct(await fetch(`${this.baseApiUrl}/updatePaymentMethod`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethodId:t.id,paymentLast4:t.card.last4})}))}async getSubscriptionStatus(){if(!this.subscriptionId)throw"No subscription id";const t=await fetch(`${this.baseApiUrl}/verifySubscription`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptionId:this.subscriptionId})});return(await Ct(t)).status}onProductSelect(t){if(!this.subscriptionId)if(t.classList.contains("selected"))t.classList.remove("selected"),this.priceId=null,this.submitBtn.setAttribute("disabled","true");else{for(const t of this.products)t.classList.remove("selected");t.classList.add("selected"),this.priceId=t.getAttribute("data-price"),this.submitBtn.removeAttribute("disabled")}}onOrgSelect(t){if(!this.subscriptionId)if(t.classList.contains("selected"))t.classList.remove("selected"),this.org=void 0,this.baseApiUrl=void 0,this.form.hidden=!0;else{for(const t of this.orgs)t.classList.remove("selected");t.classList.add("selected");const e=t.getAttribute("data-email");this.emailInput.parentElement.hidden=!!e,this.emailInput.required=!e,this.org=t.getAttribute("data-org"),this.baseApiUrl=t.getAttribute("data-url"),this.form.hidden=!1}}onCardChange(t){this.displayError(t.error?t.error.message:""),this.isCardValid=t.complete}displayError(t){t?(this.formErrors.textContent=t,this.formErrors.hidden=!1):this.formErrors.hidden=!0}}async function Ct(t){if(t.ok){const e=await t.json();if(e.error)throw e.error;return e}throw t.statusText}function kt(){return{base:{color:qt()?"#F5F5F5":"#333",fontFamily:"'Source Sans Pro', sans-serif",fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#979797"},iconColor:qt()?"#F5F5F5":"#333"},invalid:{color:"#fa755a",iconColor:"#fa755a"}}}function qt(){var t,e;return null!==(e=null===(t=document.querySelector("html"))||void 0===t?void 0:t.classList.contains("dark"))&&void 0!==e&&e}const _t=window.location.hostname.includes("huggingface.co")?"pk_live_x2tdjFXBCvXo2FFmMybezpeM00J6gPCAAc":"pk_test_7y1Olrx3i4cvYcsUZfnVbcQ800bH8yP71r";class Dt{constructor(t){var e;this.baseApiUrl=t,this.overlay=document.querySelector(".overlay"),this.upForm=document.querySelector("#update-form"),this.upErrors=this.upForm.querySelector(".form-errors"),this.fullnameInput=this.upForm.querySelector("#name"),this.subscriptionId=this.upForm.getAttribute("data-subscription"),this.cancelForm=document.querySelector("#cancellation-form"),this.cancelErrors=null===(e=this.cancelForm)||void 0===e?void 0:e.querySelector(".error"),this.init()}async init(){var t;this.stripe=await Tt(_t),window.customElements.get("details-dialog")||window.customElements.define("details-dialog",ft);const e=this.stripe.elements();this.cardElement=e.create("card",{style:kt()}),this.cardElement.mount("#card-element"),this.cardElement.on("change",t=>this.onCardChange(t)),this.upForm.addEventListener("submit",async t=>{t.preventDefault(),this.overlay.hidden=!1,this.upErrors.hidden=!0;try{await this.onSubscriptionSubmit()}catch(t){this.displayError(t,this.upErrors)}this.overlay.hidden=!0}),null===(t=this.cancelForm)||void 0===t||t.addEventListener("submit",async t=>{t.preventDefault();try{await this.onSubscriptionCancellation()}catch(t){this.displayError(t,this.cancelErrors)}})}async onSubscriptionSubmit(){var t;if(!this.isCardValid)return;const e=await this.stripe.createPaymentMethod({card:this.cardElement,type:"card",billing_details:{name:this.fullnameInput.value}});if(e.error)throw null!==(t=e.error.message)&&void 0!==t?t:JSON.stringify(e.error);const s=await this.updatePaymentMethod(e.paymentMethod);if("requires_payment_method"===s.paymentStatus){const t=await this.stripe.confirmCardPayment(s.paymentSecret,{payment_method:e.paymentMethod.id});if(t.error)throw t.error.message;await fetch(`${this.baseApiUrl}/verifySubscription`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptionId:this.subscriptionId})})}this.overlay.hidden=!0,window.location.reload()}async onSubscriptionCancellation(){await this.cancelSubscription(),window.location.reload()}async updatePaymentMethod(t){return Ct(await fetch(`${this.baseApiUrl}/updatePaymentMethod`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethodId:t.id,paymentLast4:t.card.last4})}))}async cancelSubscription(){return Ct(await fetch(`${this.baseApiUrl}/subscription`,{method:"DELETE",headers:{"Content-Type":"application/json"}}))}onCardChange(t){this.displayError(t.error?t.error.message:null,this.upErrors),this.isCardValid=t.complete}displayError(t,e){t?(e.textContent=t,e.hidden=!1):e.hidden=!0}}var jt;!function(t){t[t.join=0]="join",t[t.login=1]="login",t[t.model=2]="model",t[t.models=3]="models",t[t.datasets=4]="datasets",t[t.metrics=5]="metrics",t[t.blog=6]="blog",t[t.docs=7]="docs",t[t.home=8]="home",t[t.org_people=9]="org_people",t[t.user_subscription=10]="user_subscription",t[t.user_subscription_settings=11]="user_subscription_settings",t[t.org_subscription=12]="org_subscription",t[t.org_subscription_settings=13]="org_subscription_settings",t[t.org_subscription_pro=14]="org_subscription_pro"}(jt||(jt={}));const It={page:document.body.classList.contains("join")?jt.join:document.body.classList.contains("login")?jt.login:document.body.classList.contains("model")?jt.model:document.body.classList.contains("models")?jt.models:document.body.classList.contains("datasets")?jt.datasets:document.body.classList.contains("metrics")?jt.metrics:document.body.classList.contains("blog")?jt.blog:document.body.classList.contains("docs")?jt.docs:document.body.classList.contains("home")?jt.home:document.body.classList.contains("organization-people")?jt.org_people:document.body.classList.contains("user-subscription")?jt.user_subscription:document.body.classList.contains("user-subscription-settings")?jt.user_subscription_settings:document.body.classList.contains("org-subscription")?jt.org_subscription:document.body.classList.contains("org-subscription-settings")?jt.org_subscription_settings:document.body.classList.contains("org-subscription-pro")?jt.org_subscription_pro:void 0,onLoad:(t,e)=>{(t===It.page||It.page&&Array.isArray(t)&&t.includes(It.page))&&document.addEventListener("DOMContentLoaded",()=>{e()})}};document.addEventListener("DOMContentLoaded",()=>{(()=>{const t=Array.from(document.querySelectorAll("details.dropdown"));for(const e of t)document.addEventListener("click",t=>{t.target&&t.target instanceof Node&&e.open&&!e.contains(t.target)&&e.removeAttribute("open")})})(),(()=>{window.customElements.define("auto-complete",P);const t=document.querySelector(".navbar auto-complete");t&&t.addEventListener("auto-complete-change",()=>{console.log(t.value),window.location.href=t.value})})(),K.install(),(()=>{const t=document.querySelector(".markdown-content"),e=[...t?Array.from(t.querySelectorAll("h1, h2, h3, h4, h5, h6 [id]")):[],...Array.from(document.querySelectorAll(".js-anchor_link"))];for(const t of e){if(0===t.id.length)continue;const e=document.createElement("a");e.className="anchor-link",e.href=`#${t.id}`,e.innerHTML='<img src="/front/assets/icon-link.svg">',e.setAttribute("aria-hidden","true"),t.appendChild(e)}})(),(()=>{const t=Array.from(document.querySelectorAll(".js-copy-clipboard"));for(const e of t){const t=e.querySelector(".copy-trigger");t&&t.addEventListener("click",()=>{f(e.innerText.trim())})}})();const t=document.querySelector("input.js-file-upload");t&&t.addEventListener("change",async e=>{var s;const n=(null!==(s=t.files)&&void 0!==s?s:[])[0];if(!n)return;const i=await S.sharedInstance.uploadFile(n),r=t.dataset.name;document.querySelectorAll(`input[name=${r}]`).forEach(t=>{t.remove()}),t.insertAdjacentHTML("afterend",`<input type="hidden" name="${r}" value="${i}">`),t.insertAdjacentHTML("afterend","<small>âœ…</small>")});for(const t of document.querySelectorAll("table.js-tablesort"))new et(t)}),It.onLoad(jt.join,()=>{t.log("join");const e=document.querySelector("form");document.querySelector(".btn-primary").addEventListener("click",t=>{if(t.preventDefault(),e.reportValidity())return e.submit()})}),It.onLoad(jt.model,()=>{m();const t=new v,e=document.querySelector(".js-list_files");null==e||e.addEventListener("click",e=>{e.preventDefault(),t.show()})}),It.onLoad(jt.models,()=>{(new b).launch()}),It.onLoad([jt.datasets,jt.metrics],()=>{(new w).launch()}),It.onLoad(jt.org_people,()=>new vt),It.onLoad(jt.user_subscription,()=>{new $t("/api/user")}),It.onLoad(jt.user_subscription_settings,()=>{new Dt("/api/user")}),It.onLoad(jt.org_subscription,()=>{const t=window.location.pathname.split("/")[2];new $t(`/api/organizations/${t}`)}),It.onLoad(jt.org_subscription_settings,()=>{const t=window.location.pathname.split("/")[2];new Dt(`/api/organizations/${t}`)}),It.onLoad(jt.org_subscription_pro,()=>{new $t}),It.onLoad(jt.home,()=>{const t=document.querySelector("div.objects-search");if(t){const e=t.querySelectorAll("input, details"),s=["focus","toggle"];for(const t of e)for(const e of s)t.addEventListener(e,()=>{window.location.href="/models"})}const e=document.querySelector("div.background-inner[data-pattern]");e&&new L(e).setup(),A.init(document.querySelectorAll("[data-tilt]"),{glare:!0,scale:1.06,"max-glare":.3,speed:400})})}();